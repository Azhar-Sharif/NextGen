{% extends "base.html" %}

{% block content %}
<div class="interview-container">

    <!-- Question Section -->
    <div id="questionSection">
        <h2>Current Question:</h2>
        <p id="questionText" class="question-text">{{question_text}}</p>
    </div>

    <!-- Hidden Audio Player -->
    <audio id="question-audio" autoplay>
        <source src="{{ question_audio }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const questionTextElement = document.getElementById('questionText');
        const audioElement = document.getElementById('question-audio');

        const questionText = "{{ first_question }}"; // Question text from the backend
        const typingSpeed = 50; // Speed of typing effect in milliseconds

        // Function to display text with a typing effect
        function typeText(text, element, delay) {
            let index = 0;
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    setTimeout(type, delay);
                }
            }
            type();
        }

        // Play audio and start typing effect in parallel
        audioElement.play().catch(err => {
            console.error("Audio playback failed:", err);
        });

        // Calculate delay based on audio duration and start typing effect
        audioElement.addEventListener('loadedmetadata', function () {
            const audioDuration = audioElement.duration; // Get audio duration in seconds
            const delay = (audioDuration * 1000) / questionText.length; // Calculate delay per character
            typeText(questionText, questionTextElement, delay);
        });
    });
</script>
{% endblock %}
