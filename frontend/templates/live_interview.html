{% extends "base.html" %}

{% block content %}
<div class="interview-container">

    <!-- Question Section -->
    <div class="question-section">
        <div class="current-question">
            <h2>Current Question:</h2>
            <p id="questionText" class="question-text">{{ first_question }}</p>
        </div>
    </div>

    <!-- Hidden Audio Player -->
    <audio id="question-audio" autoplay>
        <source src="{{ question_audio }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Fetch Next Question Button -->
    <div class="next-question-section">
        <button id="fetchNextQuestion" class="btn btn-primary">Next Question</button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fetchNextQuestionButton = document.getElementById('fetchNextQuestion');

        fetchNextQuestionButton.addEventListener('click', function () {
            fetch('/api/interview/next-question', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.status === 'success') {
                        // Redirect to the results page with the next question
                        window.location.href = `/results?question=${encodeURIComponent(data.question)}&audio=${encodeURIComponent(data.audio)}`;
                    } else if (data.status === 'completed') {
                        alert(data.message);
                        window.location.href = '/results'; // Redirect to results page
                    } else {
                        console.error('Error fetching next question:', data.message);
                    }
                })
                .catch((error) => {
                    console.error('Error fetching the next question:', error);
                });
        });
    });
</script>
{% endblock %}
